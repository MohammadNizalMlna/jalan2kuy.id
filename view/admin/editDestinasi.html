<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit Destination</title>

<link rel="stylesheet" href="/css/admin/editDestination.css">
<script src="/js/destinations.js"></script>
<script src="/js/detailEvent.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

</head>
<body>

<div id="navbar"></div>

<main>

<h1 class="edit-title">
    Edit<br>
    <div class="title-edit-box">
        <input type="text" id="titleField" class="title-input">
        <i class="fas fa-pen title-icon"></i>
    </div>
</h1>

<section class="edit-grid">

    <!-- THUMBNAIL -->
    <div class="thumb-box">
        <img id="thumbPreview" class="thumb-img">
        <label class="edit-thumb-btn">
            <i class="fas fa-pen"></i> Change Thumbnail
            <input type="file" id="thumbInput" accept="image/*">
        </label>
    </div>

    <!-- DESKRIPSI -->
    <div class="desc-box">
        <label>Deskripsi</label>
        <textarea id="descField"></textarea>
    </div>

    <!-- IMAGE -->
    <div class="image-box">
        <img id="imagePreview" class="main-img">
        <label class="edit-img-btn">
            <i class="fas fa-pen"></i> Change Image
            <input type="file" id="imgInput" accept="image/*">
        </label>
    </div>

    <!-- INFO -->
    <div class="info-box">
        <label>Lokasi Tempat</label>
        <input type="text" id="locField">

        <label>Jam Buka</label>
        <input type="text" id="openNoteField">

        <label></label>
        <div class="jam-operasional">
            <input type="time" id="openField">
            <span>-</span>
            <input type="time" id="closeField">
        </div>

        <label></label>
        <input type="text" id="timezoneField">

        <label>Harga Tiket Masuk (Rp)</label>
        <input type="number" id="priceField">
    </div>

    <!-- EVENT -->
    <div class="event-box">
        <label>Event Terkait</label>
        <select id="eventSelect">
            <option value="">Tidak ada Event</option>
        </select>
    </div>

    <!-- SAVE BUTTON -->
    <button class="save-button" id="saveBtn">Save</button>

</section>
</main>

<div id="footer"></div>

<script>
fetch('/tamplate/navbarAdmin.html').then(r => r.text()).then(d => navbar.innerHTML = d);
fetch('/tamplate/footer.html').then(r => r.text()).then(d => footer.innerHTML = d);

const p = new URLSearchParams(window.location.search);
const id = p.get("id");
const cat = p.get("category");

let found = null;

if (cat && allDestinations[cat]) {
    found = allDestinations[cat].find(d => d.id === id);
}

if (!found) { alert("Data tidak ditemukan!"); }

// isi dropdown event
const eventSelect = document.getElementById("eventSelect");
events.forEach(ev => {
    const opt = document.createElement("option");
    opt.value = ev.id;
    opt.textContent = ev.title;
    eventSelect.appendChild(opt);
});

// isi field
titleField.value = found.name;
thumbPreview.src = found.thumbnail;
imagePreview.src = found.image;
descField.value = found.desc;
locField.value = found.location;
openNoteField.value = found.openNote || "";
openField.value = found.openStart || "";
closeField.value = found.openEnd || "";
timezoneField.value = found.openTimezone || "";
priceField.value = found.price.replace(/\D/g, "");
eventSelect.value = found.event || "";

// preview
thumbInput.onchange = () => thumbPreview.src = URL.createObjectURL(thumbInput.files[0]);
imgInput.onchange = () => imagePreview.src = URL.createObjectURL(imgInput.files[0]);

// save
saveBtn.onclick = () => {
    found.name = titleField.value;
    found.desc = descField.value;
    found.location = locField.value;
    found.openNote = openNoteField.value;
    found.openStart = openField.value;
    found.openEnd = closeField.value;
    found.openTimezone = timezoneField.value;
    found.price = "Rp" + priceField.value;
    found.event = eventSelect.value;

    alert("Data berhasil diupdate!");
    window.location.href = `/view/admin/destinasi/destinationDetail.html?id=${id}&category=${cat}`;
};
</script>

</body>
</html>
