<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jalan2kuy.id - Add Destination (Admin)</title>

    <link rel="stylesheet" href="/css/admin/addDestinasi.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <script src="/js/detailEvent.js"></script>
    <script src="/js/destinations.js"></script>
</head>

<body>

<div id="navbar"></div>
<h1 class="page-title">Add Destination</h1>
<div class="form-container">
    <form class="destination-form" id="destinationForm">

        <!-- Upload Thumbnail -->
        <div class="form-item item-thumbnail">
            <i class="fas fa-plus"></i> Add Thumbnail Image
            <input type="file" id="thumbnail" accept="image/*" class="file-input">
        </div>

        <!-- Deskripsi -->
        <div class="form-item item-deskripsi">
            <label for="description">Deskripsi</label>
            <textarea id="description" placeholder="Masukkan deskripsi panjang destinasi..."></textarea>
        </div>

        <!-- Upload Image Utama -->
        <div class="form-item item-add-image">
            <i class="fas fa-plus"></i> Add Image
            <input type="file" id="galleryImg" accept="image/*" class="file-input">
        </div>

        <!-- Informasi Tempat -->
        <div class="form-item item-info">
            <!-- lokasi  -->
            <div class="info-row">
                <label for="lokasi">Lokasi Tempat</label>
                <input type="text" id="lokasi" placeholder="Masukkan lokasi destinasi..." required>
            </div>
            <!-- jam buka -->
            <div class="info-row">
                <label for="note">Jam Buka</label>
                <input type="text" id="note" placeholder="Contoh: Setiap Hari, 24 Jam">
            </div>
            <!-- jam operaional -->
            <div class="info-row">
                <label></label>
                <div class="jam-operasional">
                    <input type="time" id="jam-buka">
                    <span>-</span>
                    <input type="time" id="jam-tutup">
                </div>
            </div>
            <!-- zona waktu -->
            <div class="info-row">
                <label></label>
                <input type="text" id="timezone" placeholder="WIB / WITA / WIT">
            </div>
            <!-- harga tiket -->
            <div class="info-row">
                <label for="harga">Harga Tiket Masuk (Rp)</label>
                <input type="number" id="harga" placeholder="contoh: 25000" min="0" required>
            </div>
        </div>

        <!-- Event Terkait -->
        <div class="form-item item-event">
            <label for="eventSelect">Event</label>
            <div class="event-row">
                <select id="eventSelect">
                    <option value="">Tidak ada Event</option>
                </select>
                <button type="button" id="addEventBtn" class="add-event-btn">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>
        <!-- Submit -->
        <button type="submit" class="submit-button">Tambah</button>
    </form>
</div>

<div id="footer"></div>


<script>
    // Load Navbar + Footer
    fetch('/tamplate/navbarAdmin.html').then(r => r.text()).then(d => navbar.innerHTML = d);
    fetch('/tamplate/footer.html').then(r => r.text()).then(d => footer.innerHTML = d);


    // Ambil kategori dari URL
    const params = new URLSearchParams(window.location.search);
    const category = params.get("category");
    // Isi dropdown event
    const eventSelect = document.getElementById("eventSelect");
    events.forEach(ev => {
        const opt = document.createElement("option");
        opt.value = ev.id;
        opt.textContent = ev.title;
        eventSelect.appendChild(opt);
    });

    // Tombol tambah event baru
    document.getElementById("addEventBtn").addEventListener("click", () => {
        window.location.href = "/view/admin/eventAdmin/addEventViaDestination.html";
    });

    // Submit data destinasi
    document.getElementById("destinationForm").addEventListener("submit", function(e) {
        e.preventDefault();
        let stored = JSON.parse(localStorage.getItem("destinations")) || allDestinations;
        const newData = {
            id: "dest" + Date.now(),
            name: "New Destination",
            thumbnail: "",
            image: "",
            background: "",
            desc: description.value,
            location: lokasi.value,
            openNote: note.value,
            openStart: document.getElementById("jam-buka").value,
            openEnd: document.getElementById("jam-tutup").value,
            openTimezone: timezone.value,
            price: "Rp" + harga.value,
            event: eventSelect.value
        };
        
        if (!stored[category]) stored[category] = [];
        stored[category].push(newData);
        localStorage.setItem("destinations", JSON.stringify(stored));
        alert("Destinasi berhasil ditambahkan!");
        window.location.href = `/view/admin/destinasi/categori.html?category=${category}`;
    });
</script>

</body>
</html>
